<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SDN 1 PASIRPOGOR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #3b82f6;
            --light-blue: #dbeafe;
            --primary-green: #059669;
            --secondary-green: #10b981;
            --light-green: #d1fae5;
            --error: #dc2626;
            --warning: #f59e0b;
            --pure-white: #ffffff;
            --off-white: #f8fafc;
            --gray-50: #f9fafb;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--light-green) 100%);
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        /* ========== ANIMATIONS ========== */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        /* ========== LOGIN PAGE ========== */
        #loginPage {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        #loginPage::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
            animation: pulse 6s ease-in-out infinite;
        }
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 460px;
            padding: 48px 40px;
            text-align: center;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
            z-index: 1;
        }
        .logo-container {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            box-shadow: var(--shadow-lg);
        }
        .logo {
            font-size: 2rem;
            color: var(--pure-white);
        }
        .title h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .title p {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 32px;
            font-weight: 500;
        }
        .form-group {
            margin-bottom: 24px;
            text-align: left;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
        }
        .input-container {
            position: relative;
        }
        .form-group input {
            width: 100%;
            padding: 16px 20px 16px 48px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background-color: var(--pure-white);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
            font-size: 0.875rem;
        }
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: var(--error);
            padding: 12px 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-size: 0.875rem;
            display: none;
        }
        .btn-login {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
            color: var(--pure-white);
            border: none;
            padding: 16px 24px;
            width: 100%;
            border-radius: 12px;
            margin: 24px 0;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .btn-login:active {
            transform: translateY(0);
        }
        /* ========== DASHBOARD PAGE ========== */
        #dashboardPage {
            display: none;
            min-height: 100vh;
            background: var(--off-white);
        }
        .header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: var(--pure-white);
            padding: 20px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-md);
            position: relative;
            z-index: 100;
        }
        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .header-title i {
            font-size: 1.5rem;
        }
        .header-title h1 {
            font-size: 1.25rem;
            font-weight: 700;
        }
        .header-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-top: 4px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .user-details {
            text-align: right;
        }
        .user-name {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .user-role {
            font-size: 0.75rem;
            opacity: 0.8;
        }
        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: var(--pure-white);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        .layout-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        .sidebar {
            width: 280px;
            background: var(--pure-white);
            box-shadow: var(--shadow-sm);
            border-right: 1px solid var(--gray-200);
            animation: slideInRight 0.6s ease-out;
        }
        .menu-item {
            padding: 16px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--gray-100);
            font-weight: 500;
            color: var(--gray-700);
        }
        .menu-item:hover {
            background: var(--gray-100);
            color: var(--primary-blue);
            transform: translateX(4px);
        }
        .menu-item.active {
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--light-green) 100%);
            color: var(--primary-blue);
            border-right: 4px solid var(--primary-green);
        }
        .menu-item i {
            font-size: 1.125rem;
            width: 20px;
        }
        .main-content {
            flex: 1;
            padding: 32px;
            background: var(--off-white);
            overflow-y: auto;
        }
        .card {
            background: var(--pure-white);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            margin-bottom: 24px;
            animation: fadeInUp 0.6s ease-out;
        }
        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        .stat-card {
            background: var(--pure-white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: var(--pure-white);
        }
        .stat-icon.blue {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
        }
        .stat-icon.green {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 4px;
        }
        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
        }
        /* ========== PRESENSI STYLES ========== */
        .class-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--gray-100);
            padding-bottom: 16px;
        }
        .tab-btn {
            padding: 12px 20px;
            border: 2px solid var(--gray-300);
            background: var(--pure-white);
            color: var(--gray-600);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        .tab-btn:hover {
            border-color: var(--secondary-blue);
            color: var(--secondary-blue);
            transform: translateY(-1px);
        }
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            color: var(--pure-white);
            border-color: transparent;
            box-shadow: var(--shadow-md);
        }
        .attendance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 12px;
            border: 1px solid var(--gray-200);
        }
        .date-selector {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .date-selector label {
            font-weight: 600;
            color: var(--gray-700);
        }
        .date-selector input {
            padding: 10px 14px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-weight: 500;
            background: var(--pure-white);
            transition: all 0.3s ease;
        }
        .date-selector input:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .attendance-actions {
            display: flex;
            gap: 12px;
        }
        .btn-action {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
        }
        .btn-action.primary {
            background: var(--primary-green);
            color: var(--pure-white);
            box-shadow: var(--shadow-sm);
        }
        .btn-action.secondary {
            background: var(--secondary-blue);
            color: var(--pure-white);
            box-shadow: var(--shadow-sm);
        }
        .btn-action:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        .attendance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .summary-item {
            background: var(--pure-white);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        .summary-item.present {
            border-color: var(--primary-green);
            background: var(--light-green);
        }
        .summary-item.absent {
            border-color: var(--error);
            background: #fef2f2;
        }
        .summary-item.sick {
            border-color: var(--warning);
            background: #fffbeb;
        }
        .summary-item.permit {
            border-color: #2196f3;
            background: #eff6ff;
        }
        .summary-item i {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }
        .summary-item.present i {
            color: var(--primary-green);
        }
        .summary-item.absent i {
            color: var(--error);
        }
        .summary-item.sick i {
            color: var(--warning);
        }
        .summary-item.permit i {
            color: #2196f3;
        }
        .summary-item .number {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
        }
        .summary-item .label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
        }
        .attendance-table-container {
            background: var(--pure-white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
        }
        .attendance-table th {
            background: var(--gray-100);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.875rem;
        }
        .attendance-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--gray-100);
            vertical-align: middle;
        }
        .attendance-table tbody tr:hover {
            background: var(--gray-50);
        }
        .status-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        .status-btn {
            padding: 6px 10px;
            border: 2px solid;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .status-btn i {
            font-size: 0.625rem;
        }
        .status-btn.present {
            background: var(--light-green);
            border-color: var(--primary-green);
            color: var(--primary-green);
        }
        .status-btn.present.active {
            background: var(--primary-green);
            color: var(--pure-white);
        }
        .status-btn.absent {
            background: #fef2f2;
            border-color: var(--error);
            color: var(--error);
        }
        .status-btn.absent.active {
            background: var(--error);
            color: var(--pure-white);
        }
        .status-btn.sick {
            background: #fffbeb;
            border-color: var(--warning);
            color: var(--warning);
        }
        .status-btn.sick.active {
            background: var(--warning);
            color: var(--pure-white);
        }
        .status-btn.permit {
            background: #eff6ff;
            border-color: #2196f3;
            color: #2196f3;
        }
        .status-btn.permit.active {
            background: #2196f3;
            color: var(--pure-white);
        }
        .note-input {
            padding: 8px 10px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.75rem;
            width: 140px;
            transition: all 0.3s ease;
        }
        .note-input:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        /* Dark Mode */
        .dark-mode {
            --pure-white: #1e293b;
            --off-white: #0f172a;
            --gray-50: #1e293b;
            --gray-100: #334155;
            --gray-200: #475569;
            --gray-600: #cbd5e1;
            --gray-700: #e2e8f0;
        }
        .dark-mode .login-container,
        .dark-mode .card,
        .dark-mode .sidebar {
            background: var(--gray-50) !important;
            border-color: var(--gray-200) !important;
        }
        .dark-mode .form-group input {
            background: var(--gray-100) !important;
            color: white !important;
        }
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-green);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-xl);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
        }
        .toast.show { 
            opacity: 1; 
            bottom: 30px; 
        }
        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
            .main-content {
                padding: 24px;
            }
        }
        @media (max-width: 768px) {
            .layout-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
            }
            .header {
                padding: 16px 20px;
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
            .header-title h1 {
                font-size: 1.125rem;
            }
            .user-info {
                gap: 12px;
            }
            .main-content {
                padding: 20px;
            }
            .login-container {
                padding: 32px 24px;
                max-width: 360px;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .class-tabs {
                gap: 6px;
            }
            .tab-btn {
                padding: 10px 16px;
                font-size: 0.75rem;
            }
            .status-buttons {
                gap: 4px;
            }
            .status-btn {
                padding: 4px 8px;
                font-size: 0.625rem;
            }
        }
        @media (max-width: 480px) {
            .menu-item {
                padding: 12px 20px;
            }
            .card {
                padding: 24px 20px;
            }
            .attendance-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            .attendance-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage">
        <div class="login-container">
            <div class="logo-container">
                <i class="fas fa-graduation-cap logo"></i>
            </div>
            <div class="title">
                <h1>SDN 1 PASIRPOGOR</h1>
                <p>APLIKASI ADMINISTRASI SEKOLAH</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <div class="input-container">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="username" placeholder="Masukkan username Anda" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="input-container">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="password" placeholder="Masukkan password Anda" required>
                    </div>
                </div>
                
                <div class="error-message" id="errorMessage">
                    Username atau password salah!
                </div>
                
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage">
        <div class="header">
            <div class="header-title">
                <i class="fas fa-graduation-cap"></i>
                <div>
                    <h1 id="headerTitle">SDN 1 PASIRPOGOR</h1>
                    <div class="header-subtitle" id="headerSubtitle">Dashboard Administrasi</div>
                </div>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">AD</div>
                <div class="user-details">
                    <div class="user-name" id="userName">Administrator</div>
                    <div class="user-role" id="userRole">Admin</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Keluar
                </button>
            </div>
        </div>

        <div class="layout-container">
            <div class="sidebar">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" data-page="presensi">
                    <i class="fas fa-user-check"></i>
                    <span>Presensi Siswa</span>
                </div>
                <div class="menu-item" data-page="nilai">
                    <i class="fas fa-book-open"></i>
                    <span>Nilai Siswa</span>
                </div>
                <div class="menu-item" data-page="laporan">
                    <i class="fas fa-chart-bar"></i>
                    <span>Laporan</span>
                </div>
            </div>

            <div class="main-content">
                <div class="card" id="dashboardContent">
                    <h2 class="card-title">Dashboard Administrasi</h2>
                    <p style="color: var(--gray-600); margin-bottom: 32px;">Selamat datang di sistem administrasi sekolah modern. Kelola data sekolah dengan mudah dan efisien.</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-number">241</div>
                                    <div class="stat-label">Total Siswa</div>
                                </div>
                                <div class="stat-icon blue">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-number">6</div>
                                    <div class="stat-label">Guru Aktif</div>
                                </div>
                                <div class="stat-icon green">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-number">6</div>
                                    <div class="stat-label">Kelas Aktif</div>
                                </div>
                                <div class="stat-icon blue">
                                    <i class="fas fa-door-open"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-number">95%</div>
                                    <div class="stat-label">Kehadiran Hari Ini</div>
                                </div>
                                <div class="stat-icon green">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" id="presensiContent" style="display:none">
                    <h2 class="card-title">Presensi Siswa</h2>
                    <p style="color: var(--gray-600); margin-bottom: 24px;">Kelola absensi dan kehadiran siswa dengan sistem yang terintegrasi dan real-time.</p>
                    
                    <!-- Class Tabs -->
                    <div class="class-tabs" id="classTabs">
                        <button class="tab-btn active" data-class="1">Kelas 1</button>
                        <button class="tab-btn" data-class="2">Kelas 2</button>
                        <button class="tab-btn" data-class="3">Kelas 3</button>
                        <button class="tab-btn" data-class="4">Kelas 4</button>
                        <button class="tab-btn" data-class="5">Kelas 5</button>
                        <button class="tab-btn" data-class="6">Kelas 6</button>
                    </div>

                    <!-- Class Content -->
                    <div id="classContent">
                        <!-- Date Selector & Actions -->
                        <div class="attendance-header">
                            <div class="date-selector">
                                <label for="attendanceDate">Tanggal:</label>
                                <input type="date" id="attendanceDate" value="2025-08-13">
                            </div>
                            <div class="attendance-actions">
                                <button class="btn-action primary" id="markAllPresent">
                                    <i class="fas fa-check"></i> Hadir Semua
                                </button>
                                <button class="btn-action secondary" id="saveAttendance">
                                    <i class="fas fa-save"></i> Simpan
                                </button>
                                <button class="btn-action secondary" id="exportAttendance">
                                    <i class="fas fa-file-export"></i> Ekspor CSV
                                </button>
                            </div>
                        </div>

                        <!-- Attendance Summary -->
                        <div class="attendance-summary">
                            <div class="summary-item present">
                                <i class="fas fa-check"></i>
                                <span class="number" id="presentCount">0</span>
                                <span class="label">Hadir</span>
                            </div>
                            <div class="summary-item absent">
                                <i class="fas fa-times"></i>
                                <span class="number" id="absentCount">0</span>
                                <span class="label">Alpha</span>
                            </div>
                            <div class="summary-item sick">
                                <i class="fas fa-hospital"></i>
                                <span class="number" id="sickCount">0</span>
                                <span class="label">Sakit</span>
                            </div>
                            <div class="summary-item permit">
                                <i class="fas fa-file-alt"></i>
                                <span class="number" id="permitCount">0</span>
                                <span class="label">Izin</span>
                            </div>
                        </div>

                        <!-- Attendance Table -->
                        <div class="attendance-table-container">
                            <table class="attendance-table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Siswa</th>
                                        <th>Status Kehadiran</th>
                                        <th>Keterangan</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceTableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card" id="nilaiContent" style="display:none">
                    <h2 class="card-title">Nilai Siswa</h2>
                    <p style="color: var(--gray-600);">Kelola dan pantau perkembangan nilai siswa secara komprehensif.</p>
                    <div style="margin-top: 24px; padding: 32px; background: var(--gray-100); border-radius: 12px; text-align: center;">
                        <i class="fas fa-book-open" style="font-size: 3rem; color: var(--primary-blue); margin-bottom: 16px;"></i>
                        <p style="color: var(--gray-600);">Fitur nilai siswa sedang dalam pengembangan</p>
                    </div>
                </div>

                <div class="card" id="laporanContent" style="display:none">
                    <h2 class="card-title">Laporan</h2>
                    <p style="color: var(--gray-600);">Generate dan analisis laporan sekolah secara otomatis.</p>
                    <div style="margin-top: 24px; padding: 32px; background: var(--gray-100); border-radius: 12px; text-align: center;">
                        <i class="fas fa-chart-bar" style="font-size: 3rem; color: var(--primary-green); margin-bottom: 16px;"></i>
                        <p style="color: var(--gray-600);">Fitur laporan sedang dalam pengembangan</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple hash function for passwords
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = (hash << 5) - hash + str.charCodeAt(i);
            }
            return hash.toString();
        }

        // User accounts database with hashed passwords
        const users = {
            'admin': { 
                password: simpleHash('admin123'),
                role: 'admin', 
                name: 'Administrator', 
                initials: 'AD',
                classes: [1, 2, 3, 4, 5, 6]
            },
            'adesulastri': { 
                password: simpleHash('kelas1'),
                role: 'guru', 
                name: 'Ade Sulastri', 
                kelas: 1, 
                initials: 'AS',
                classes: [1]
            },
            'widiamuhardini': { 
                password: simpleHash('kelas2'),
                role: 'guru', 
                name: 'Widia Muhardini', 
                kelas: 2, 
                initials: 'WM',
                classes: [2]
            },
            'syifayuliani': { 
                password: simpleHash('kelas3'),
                role: 'guru', 
                name: 'Syifa Yuliani', 
                kelas: 3, 
                initials: 'SY',
                classes: [3]
            },
            'dianamelia': { 
                password: simpleHash('kelas4'),
                role: 'guru', 
                name: 'Diana Melia', 
                kelas: 4, 
                initials: 'DM',
                classes: [4]
            },
            'litapurnama': { 
                password: simpleHash('kelas5'),
                role: 'guru', 
                name: 'Lita Purnama', 
                kelas: 5, 
                initials: 'LP',
                classes: [5]
            },
            'didinsuhud': { 
                password: simpleHash('kelas6'),
                role: 'guru', 
                name: 'Didin Suhud', 
                kelas: 6, 
                initials: 'DS',
                classes: [6]
            }
        };

        // Real student data from school
        const classData = {
            1: [
                "AFIZA NADHIFATUL WAFA", "AL FAZAR MUHAMMAD RIZKY", "ALARIK MAULANA ARRAFI",
                "ALBIYAN MAHARDIKA GEMILANG", "ALFAYRA SAKINA ABDILLA", "ANNA ALTAFUNNISA",
                "AYU ADZKIA", "AZRINA YASNA ARIFAH", "ERIANA PUTRI", "FAKHIRA SALWA NABILA",
                "FAKHRY ZAHRAN RABBANI", "FATHIAN RAVINDRA", "FATIMAH AZAHRA", "HAURA FAUZIAH",
                "KINAN ADSILLA WIGANDA", "LINDA MARDIANA", "M. AFKAR RAMADAN", "M. AKHDAN DZAKI FIRDAUS",
                "M. ARKAN RAMADHAN ATTHARIQ", "M. RAVA ARRIZKI", "M. SYAIBAN ILMI AR-ROFIQ",
                "MARWAH AZIZATUL IHSAN", "MEISA NURAHMA", "MIZYAN HAZIQ ABDILLAH",
                "MUHAMAD ALWI ALFAQIH", "MUHAMAD DANIS ARSALA", "MUHAMAD PAHRAN",
                "MUHAMAD PEBRIANSYAH", "MUHAMAD RIFKI KEYVIN", "MUHAMMAD PRABOWO WAHYU DINATA",
                "MUHAMMAD SANDIAGA WAHYU DINATA", "MUTIARA AZKADINA", "NADHIRA KHIRANI LAVANYA",
                "NAUFAL FIRAZ MUZAKKI", "SALSABILA QUROTUAIN", "SIKHA AYUDIA INARA",
                "SILPI LUTPIAH", "SITI HILYATUN AULIA", "SITI KANIA AZAHRA",
                "SYABIA HADIJAH MAHALI", "SYAFIYYA PUTRI JANNAH", "VIKRI HERDIANSYAH"
            ],
            2: [
                "ABDUL MULKI JADID AZIZULHAKIM", "ADIPA EMA NURYANA", "AFIFAH AZZAHRA SAHIRLI",
                "AFZA NURIL RAMADHANI", "APIZA APRILIA", "ARSYILA NURUL WAFA",
                "ARSYLA NURUL AZIZAH", "ASYLA FATMAWATI", "AYU BAKA AMINATU SALAMAH",
                "AZMYA FARIZA KHAIRUNNISA", "CLARISA NAOMI ALIFIA", "DEDE SHOLEH MALIK MAULANA",
                "DELISA MAESA PERMANA", "HUSNA AS-SYIHA SEPTIANI", "ILMA AULIA",
                "KAIFAN AKLIL SETIAWAN", "KEANU ARKARNA LANBER", "KEN EZA RASYA YUNANDA",
                "LAILA KHOMISATUL MUSAROPAH", "M FAJRI", "M PADLAN DIRGA AKBAR",
                "M ZIKRI AL-FATIH", "M. RAHES MUAS", "M.ALFI NUR SYA'BAN",
                "M.AZHAR AL-FAUZAN", "MARYAM NAJWA AURELIA", "MAULANA MUHAMMAD ADAM",
                "MUHAMAD ABKAR SABAN PRATAMA", "MUHAMAD AKBAR BASRI", "MUHAMAD ARASYD SULAIMAN",
                "MUHAMAD AWALUDIN", "MUHAMAD FARIZQI ARFAN MUTAQI", "MUHAMAD GIFAR NUGRAHA",
                "MUHAMAD KAFIN AL GHIFARI", "MUHAMAD SAUKI AL HAEDAR", "MUHAMMAD NADIF DARAJATU SA'BAN",
                "MUHAMMAD RAJENDRA ARSALAN", "MUHAMMAD RISKI PUTRA RAMADANI", "MUHAMMAD SALMAN AL-FARISY",
                "NIZAR RAFLISNDI SUDRAJAT", "RAHMI NAWAL ATTIYAH", "RARA DWI ANGGITA",
                "SAZFA SAQUEENA", "SITI NAFISAH", "SITI NAFISAH NURINAYAH",
                "SITI NAWA UKHWATUN HASANAH", "SITI SOPIAH NURAENI", "SYAHLAN MAULANA AL-FATIH",
                "ZIA ALTAFUNISA"
            ],
            3: [
                "AFNAN ATMA PERMANA", "AKBAR KHOIRUL RIZKI", "ALBI FARIZ SYAKIL",
                "ALGY SEFTIANSYAH", "AMANDA FEBRIYANI NURAISYAH", "ARSHAKA VIRENDRA SYAFWAN",
                "ARVI GIBRAN AL-FATHIR", "CEF NIZAM NURUJJAMAN", "DAFFA SAKHA PRATAMA",
                "FAHIRA SALWA AZAHRA", "GINA NURAENI", "HASBY NURUL AINUN",
                "M ADERAL JIBRIL", "M ALFARIZ MAULANA", "M ARGIA TRISIDQIA SAHAB",
                "M DZIKRI IRFAN AL MAHALI", "M DZIKRUL AZWAN", "M HAKIM RAMDANI",
                "M NIZAM ASSUBKI", "M.ANDI PURNAMA", "MUHAMAD AHZAM DWI SIDKIA SAHAB",
                "MUHAMAD ARKAN NIZAR", "MUHAMAD MUGNI AL HABSI", "MUHAMAD RIDWAN NULLOH",
                "MUHAMAD RIDWAN NUR ZAMAN", "MUHAMAD SAKTI MAULANA PUTRA SA'BAN",
                "MUHAMMAD NAZWA SYAIDIL HIDIR", "MUJTABA ATHOILLAH", "NADYA RAHMA PUSPITA",
                "NAURA HASNO ANIDA", "NAYLA NUR AZIZAH", "NAYNA MARWAH",
                "NURI ALNAIRA HASNA", "SHALWA SABILA", "ZIADUL ARIFIN"
            ],
            4: [
                "ABYAN NATHA PRASRAYA", "AHMAD SULTHON", "AL KHALIFI DZIKRI HAMIZAN",
                "AL ZAZIRA ALMAHA RUSTIANI", "ANAN AL-NAWAWI", "ANNAQYA ELFIRA FIRMANSYAH",
                "AQILA PUTRI AZZAHRA", "AULIA RAHMA WATI", "AZHAR NURSOBAH",
                "BINTANG SEPTIANI", "DAFITHA NIZZA NURWAHYUDIN", "DEISYA AZZAHRA NURAZIZAH",
                "FATHIA HAYATUN NUFUS", "FUTRI SALSA SABILLA", "HASNA RAPANDA PATHIATURAHMA",
                "IRWAN PERMANA", "JAHIRA AJKIYA RIZKI", "JAMIE ATHAILA ALTAIR RAMADHAN",
                "KHAYLLA NATASHA PUTRI", "M ADZLAN ARIF PATURAHMAN", "M. RASYA MALIKI ASSANDJURI",
                "M.DIMAS AKBAR", "MAULIDA APMALA PUTRI", "MIRZA FATHAN MAULANA",
                "MUHAMAD ALFAN AL FARIJI", "MUHAMAD FARIZ ABDULLOH", "MUHAMAD KHOIRUL YASYA",
                "MUHAMAD RIZA AL-GHIFANI", "MUHAMAD SYAFWAN SYAHPUTRA", "MUHAMAD WANDA DINATA",
                "MUHAMMAD JILDAN ARSA HIDAYAT", "MUHAMMAD SAKHI ZAIDAN", "MUHAMMAD ZAIN AKHLUEL HAQ",
                "NABILA ADZKIA FITRI", "NAURA SYAKILA ASYIFA PUTRI HARYANA", "NURSYIFA AMANATUNNISA",
                "PAHRI ARGADANA", "PARHAN MAULANA", "QOTRUNNADA NUR MAULIDA",
                "RAHMAIRA FAUJI", "RAISYA APRILIA NURAZIZAH", "REYSA MUPLIHANDINA SIDIK",
                "RIZKY DATU HUMAIRA", "SITI SANIAH RAMADANI", "TANTI NUR TAJKIAH MARHAMAH",
                "YUSNITA OKTA HUMAIRAH"
            ],
            5: [
                "AIRA ALFANISA", "ALVARO ABU RIZIQ", "AZAHRA MIKAILA PUTRI",
                "DAFFA SYADID AL GHIFARI", "DAVITA SHEILA NURASYIFA", "DIMAS SAID HAIDIR",
                "DZAKIRA ASSYABIYA RAFIFA", "HAYISAM NUGRAHA", "HILMA SYAKILA RAHMADANI",
                "KIRANA PUTRI SOFYAN", "MEZZA RIZKI MUNANDAR", "MUHAMAD IQBAL RACHMADENI",
                "MUHAMAD JUNA", "MUHAMAD RIZQI KURNIAWAN", "MUHAMAD SYAHDAN",
                "MUHAMAD WILDAN RAMDANI", "MUHAMMAD AFANDI RAHMAN", "MUHAMMAD SAHDAN ALMUHAIMIN",
                "NADILA AINA ZAHRA", "NAUFAL FADIL PRATAMA", "NAYLA PUTRI LUTHPIANA",
                "RAHAP", "SAHLA YUSHIRA ALMAHA", "SALWA TUNNISA HANIFAH",
                "SRI WAHYUNI", "UPAIRA NUR APIPAH"
            ],
            6: [
                "ADILA RAHMAYANTI", "AHMAD SAEPUL PURNAMA", "ALDY RAMADHAN SYAH",
                "ALIF AQILA PRANAJA", "ANNA SOFIATUN JANAH", "AUFI BINA FITRIANI",
                "DEVITA ADINDA SABILA", "DEWI ERNESTA NURIL M", "FADLI RAMADANI",
                "FAIREL KHOIRUL AZZAM", "ISMA NURUL PAUZIAH", "JAHRA NAYASARI SALSABILA",
                "KEYLA PUTRI RAMADANI", "LISNA ANGGRAENI RAMADHANI", "M AKMAL RAIHANUL MALIK",
                "M OSAMI YUSUF A", "M.RAIHAN SAMSUL ARIF", "MARSYA NURFADILAH HIDAYAT",
                "MAULANA PADHIL", "MOCH HILMI ALFARIJI", "MUH ZAKY RAMDANI",
                "MUHAMAD ADLI SULAIMAN", "MUHAMAD AMBRIZAM FADILAH", "MUHAMAD ARSYIL HAEDAR SAEPURROHMAN",
                "MUHAMAD DARUL AL HAFID", "MUHAMAD ERFAN ABDULAH", "MUHAMAD NAZRIL ILHAM",
                "MUHAMAD TOHA FAIZIN S", "MUHAMMAD ALFIAN RIZKI RAMDAN", "MUHAMMAD DANDI SAPUTRA",
                "MUHAMMAD FAHRI ELBIRA MAHENDRA", "MUHAMMAD FAWAJ ALPAN FAUJAN", "MUHAMMAD KAMIL AINUL HAQQI",
                "NAJWA SAKA ALBAIRUNI", "REKI DWI SAONI", "RIFALNY MAHESYA PUTRI",
                "RISKA AULIA NURPAUZIAH", "SABRINA NISFI RAHMATAL QOLBI", "SAZIRA FITRA AGUSTINA",
                "SITI NADIA SOFIA RAHMAH", "TALITHA CAHYA PUTRI", "VIVI AULIA",
                "WAFA INDA SEKARWANGI", "ZAKIRA TALITA AQILA"
            ]
        };

        let currentUser = null;
        let attendanceData = {};

        // Initialize attendance for all classes
        function initializeAttendance() {
            for (let classNum = 1; classNum <= 6; classNum++) {
                attendanceData[classNum] = {};
                classData[classNum].forEach((student, index) => {
                    attendanceData[classNum][index] = {
                        name: student,
                        status: 'present',
                        note: ''
                    };
                });
            }
        }

        // Check class access
        function checkClassAccess(classNum) {
            if (currentUser.role === 'guru' && !currentUser.classes.includes(classNum)) {
                showToast('Akses ditolak! Anda hanya bisa mengakses kelas yang ditentukan.', 'error');
                return false;
            }
            return true;
        }

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}"></i> ${message}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // LOGIN FUNCTION - FIXED
        document.getElementById("loginForm").addEventListener("submit", function(e) {
            e.preventDefault();
            
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const errorMessage = document.getElementById("errorMessage");
            
            const user = users[username];
            
            if (user && user.password === simpleHash(password)) {
                currentUser = user;
                updateUserInterface();
                setupRoleBasedDashboard();
                document.getElementById("loginPage").style.display = "none";
                document.getElementById("dashboardPage").style.display = "block";
                document.getElementById("username").value = "";
                document.getElementById("password").value = "";
                errorMessage.style.display = "none";
                showToast(`Selamat datang, ${currentUser.name}!`);
            } else {
                errorMessage.style.display = "block";
                document.getElementById("password").value = "";
                showToast('Username atau password salah!', 'error');
            }
        });

        // LOGOUT FUNCTION - FIXED (Single event listener)
        document.getElementById("logoutBtn").addEventListener("click", function() {
            if (confirm("Yakin ingin keluar? Perubahan yang belum disimpan akan hilang.")) {
                currentUser = null;
                document.getElementById("dashboardPage").style.display = "none";
                document.getElementById("loginPage").style.display = "flex";
                document.getElementById("username").value = "";
                document.getElementById("password").value = "";
                
                // Reset tabs
                const tabs = document.querySelectorAll('.tab-btn');
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                    tab.style.display = 'inline-block';
                });
                document.querySelector('.tab-btn[data-class="1"]').classList.add('active');
                
                // Reset to dashboard
                document.querySelectorAll("#dashboardPage .card").forEach(card => {
                    card.style.display = "none";
                });
                document.getElementById("dashboardContent").style.display = "block";
                document.querySelectorAll(".menu-item").forEach(item => {
                    item.classList.remove("active");
                });
                document.querySelector('.menu-item[data-page="dashboard"]').classList.add("active");
                
                showToast('Berhasil logout!');
            }
        });

        // Update user interface
        function updateUserInterface() {
            document.getElementById("userAvatar").textContent = currentUser.initials;
            document.getElementById("userName").textContent = currentUser.name;
            
            if (currentUser.role === 'admin') {
                document.getElementById("headerTitle").textContent = "SDN 1 PASIRPOGOR - ADMIN PANEL";
                document.getElementById("headerSubtitle").textContent = "Dashboard Administrator - Akses Semua Kelas";
                document.getElementById("userRole").textContent = "Administrator";
            } else {
                document.getElementById("headerTitle").textContent = `SDN 1 PASIRPOGOR - KELAS ${currentUser.kelas}`;
                document.getElementById("headerSubtitle").textContent = `Dashboard Guru - Kelas ${currentUser.kelas}`;
                document.getElementById("userRole").textContent = `Guru Kelas ${currentUser.kelas}`;
            }
        }

        // Setup role-based dashboard
        function setupRoleBasedDashboard() {
            const classTabs = document.getElementById("classTabs");
            const tabs = classTabs.querySelectorAll(".tab-btn");
            
            tabs.forEach(tab => {
                tab.style.display = "none";
                tab.classList.remove("active");
            });
            
            if (currentUser.role === 'admin') {
                tabs.forEach(tab => {
                    tab.style.display = "inline-block";
                });
                tabs[0].classList.add("active");
                renderAttendanceTable(1);
            } else if (currentUser.role === 'guru') {
                tabs.forEach(tab => {
                    const classNum = parseInt(tab.getAttribute('data-class'));
                    if (classNum === currentUser.kelas) {
                        tab.style.display = "inline-block";
                        tab.classList.add("active");
                    }
                });
                renderAttendanceTable(currentUser.kelas);
            }
        }

        // Render attendance table
        function renderAttendanceTable(classNum) {
            if (!checkClassAccess(classNum)) return;
            
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            if (!classData[classNum]) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">Data kelas tidak ditemukan</td></tr>';
                return;
            }
            
            classData[classNum].forEach((student, index) => {
                const attendance = attendanceData[classNum][index];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 600;">${index + 1}</td>
                    <td style="font-weight: 500;">${student}</td>
                    <td>
                        <div class="status-buttons">
                            <button class="status-btn present ${attendance.status === 'present' ? 'active' : ''}" 
                                    onclick="updateStatus(${classNum}, ${index}, 'present')">
                                <i class="fas fa-check"></i> Hadir
                            </button>
                            <button class="status-btn absent ${attendance.status === 'absent' ? 'active' : ''}" 
                                    onclick="updateStatus(${classNum}, ${index}, 'absent')">
                                <i class="fas fa-times"></i> Alpha
                            </button>
                            <button class="status-btn sick ${attendance.status === 'sick' ? 'active' : ''}" 
                                    onclick="updateStatus(${classNum}, ${index}, 'sick')">
                                <i class="fas fa-hospital"></i> Sakit
                            </button>
                            <button class="status-btn permit ${attendance.status === 'permit' ? 'active' : ''}" 
                                    onclick="updateStatus(${classNum}, ${index}, 'permit')">
                                <i class="fas fa-file-alt"></i> Izin
                            </button>
                        </div>
                    </td>
                    <td>
                        <input type="text" class="note-input" placeholder="Keterangan..." 
                               value="${attendance.note}" 
                               onchange="updateNote(${classNum}, ${index}, this.value)">
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updateSummary(classNum);
        }

        // Update attendance status
        function updateStatus(classNum, studentIndex, status) {
            if (!checkClassAccess(classNum)) return;
            attendanceData[classNum][studentIndex].status = status;
            renderAttendanceTable(classNum);
        }

        // Update note
        function updateNote(classNum, studentIndex, note) {
            if (!checkClassAccess(classNum)) return;
            attendanceData[classNum][studentIndex].note = note;
        }

        // Update summary counts
        function updateSummary(classNum) {
            const students = attendanceData[classNum];
            const counts = {
                present: 0,
                absent: 0,
                sick: 0,
                permit: 0
            };
            
            Object.values(students).forEach(student => {
                counts[student.status]++;
            });
            
            document.getElementById('presentCount').textContent = counts.present;
            document.getElementById('absentCount').textContent = counts.absent;
            document.getElementById('sickCount').textContent = counts.sick;
            document.getElementById('permitCount').textContent = counts.permit;
        }

        // Mark all present
        document.getElementById('markAllPresent').addEventListener('click', function() {
            const activeTab = document.querySelector('.tab-btn.active');
            if (!activeTab) return;
            
            const classNum = parseInt(activeTab.getAttribute('data-class'));
            
            if (!checkClassAccess(classNum)) return;
            
            Object.keys(attendanceData[classNum]).forEach(index => {
                attendanceData[classNum][index].status = 'present';
            });
            
            renderAttendanceTable(classNum);
            showToast('Semua siswa telah ditandai hadir!');
        });

        // Save attendance with loading
        document.getElementById('saveAttendance').addEventListener('click', function() {
            const activeTab = document.querySelector('.tab-btn.active');
            if (!activeTab) return;
            
            const classNum = parseInt(activeTab.getAttribute('data-class'));
            const date = document.getElementById('attendanceDate').value;
            
            if (!checkClassAccess(classNum)) return;
            
            const btn = this;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Menyimpan...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-save"></i> Simpan';
                btn.disabled = false;
                showToast(`Presensi Kelas ${classNum} tanggal ${date} berhasil disimpan!`);
            }, 1500);
        });

        // Export attendance to CSV
        document.getElementById('exportAttendance').addEventListener('click', function() {
            const activeTab = document.querySelector('.tab-btn.active');
            if (!activeTab) return;
            
            const classNum = parseInt(activeTab.getAttribute('data-class'));
            const date = document.getElementById('attendanceDate').value;
            
            if (!checkClassAccess(classNum)) return;
            
            let csvContent = "No,Nama Siswa,Status,Keterangan\n";
            Object.entries(attendanceData[classNum]).forEach(([index, student]) => {
                const statusMap = {
                    'present': 'Hadir',
                    'absent': 'Alpha',
                    'sick': 'Sakit',
                    'permit': 'Izin'
                };
                csvContent += `${parseInt(index) + 1},"${student.name}","${statusMap[student.status]}","${student.note}"\n`;
            });
            
            // Download file
            const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Presensi_Kelas_${classNum}_${date}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast(`File presensi kelas ${classNum} berhasil diunduh!`);
        });

        // Tab navigation for classes
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const classNum = parseInt(this.getAttribute('data-class'));
                
                if (currentUser && currentUser.role === 'guru' && classNum !== currentUser.kelas) {
                    showToast('Anda tidak memiliki akses ke kelas ini!', 'error');
                    return;
                }
                
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                renderAttendanceTable(classNum);
            });
        });

        // Menu navigation
        const menuItems = document.querySelectorAll(".menu-item");
        menuItems.forEach(item => {
            item.addEventListener("click", function() {
                const page = this.getAttribute("data-page");
                
                menuItems.forEach(i => i.classList.remove("active"));
                this.classList.add("active");
                
                document.querySelectorAll("#dashboardPage .card").forEach(card => {
                    card.style.display = "none";
                });
                document.getElementById(`${page}Content`).style.display = "block";
                
                if (page === 'presensi' && currentUser) {
                    setupRoleBasedDashboard();
                }
            });
        });

        // Initialize system
        initializeAttendance();
        document.getElementById('attendanceDate').valueAsDate = new Date();

        // Dark mode toggle
        const darkModeToggle = document.createElement('button');
        darkModeToggle.id = 'darkModeToggle';
        darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        darkModeToggle.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-blue);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            z-index: 1000;
            transition: all 0.3s ease;
        `;
        document.body.appendChild(darkModeToggle);

        darkModeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                darkModeToggle.style.background = 'var(--warning)';
                localStorage.setItem('darkMode', 'enabled');
                showToast('Mode gelap diaktifkan');
            } else {
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                darkModeToggle.style.background = 'var(--primary-blue)';
                localStorage.setItem('darkMode', 'disabled');
                showToast('Mode terang diaktifkan');
            }
        });

        // Check dark mode preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            darkModeToggle.style.background = 'var(--warning)';
        }

        // Search functionality
        const searchInput = document.createElement('input');
        searchInput.type = 'text';
        searchInput.placeholder = 'Cari nama siswa...';
        searchInput.style.cssText = `
            margin: 0 0 16px 0;
            width: 100%;
            max-width: 300px;
            padding: 10px 14px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-weight: 500;
            background: var(--pure-white);
            transition: all 0.3s ease;
        `;
        
        // Add search input to attendance header
        const attendanceHeader = document.querySelector('.attendance-header');
        if (attendanceHeader) {
            attendanceHeader.insertBefore(searchInput, attendanceHeader.firstChild);
        }

        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#attendanceTableBody tr');
            rows.forEach(row => {
                const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                row.style.display = name.includes(searchTerm) ? '' : 'none';
            });
        });

        // Add hover effects to stat cards
        document.querySelectorAll('.stat-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
    </script>
</body>
</html>